<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>vue学习</title>
<script src="assets/js/vue.js"></script>
<script src="assets/js/axios.min.js"></script>
<link rel="stylesheet" href="assets/css/amazeui.min.css" />
<link rel="stylesheet" href="assets/css/app.css">
<link rel="stylesheet" href="assets/js/plugins/layui/css/layui.css">
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=EPgo3ahLed1MOQlZDPg1fdl0DN7Pg07w"></script>
<!--加载鼠标绘制工具-->
<script type="text/javascript" src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
<link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
</head>
<body data-type="index">


    <div class="am-g tpl-g" id="allpagecontent">
            <!--头部  -->
        <header>
               <!--logo -->
            <div class="am-fl tpl-header-logo">
                <a href="javascript:;"><img src="assets/img/logo.png" alt=""></a>
            </div>
            <!--右侧内容 -->
            <div class="tpl-header-fluid">
              <!-- 侧边切换 -->
                <div class="am-fl tpl-header-switch-button am-icon-list" @click=autoLeft>
                    <span>

                </span>
                </div>
               
              </div>

        </header>
   
        
          <!-- 侧边导航栏  -->
        <div class="left-sidebar" :class={active:styleleftactive}>  
       <!-- 用户信息 -->
         	<div class="tpl-sidebar-user-panel">
                <div class="tpl-user-panel-slide-toggleable">
                    <div class="tpl-user-panel-profile-picture">
                        <img src="assets/img/user02.png" alt="">
                    </div>
                    <span class="user-panel-logged-in-text">
              		<i class="am-icon-circle-o am-text-success tpl-user-panel-status-icon" th:text="${name}"></i>
          			   
          			</span>
                    <a href="javascript:;" class="tpl-user-panel-action-link"> <span class="am-icon-pencil"></span>账号设置</a>
                </div>
            </div>   
        <!-- 菜单  -->
            <div >
            <ul class="sidebar-nav">
                 <menu-item  v-for="item in menuitems" v-bind:labeltext="item.labeltext" v-bind:styleobject=item.styleobject
                      :order=item.order @menuitemclick=getMenu ></menu-item>
                
            </ul>
            </div>
        </div>
        <div class="right-sidebar">
        </div>
        <!-- 内容  -->
        
	
	     <div class="tpl-content-wrapper" id = "mapcontent" :class={active:stylemainactive}>   
	         
	        
	        <div class="tpl-content-wrapper-main" id="mapcavans" >
	        	
	        	<div id="map1_container" :class={isshow:stylemapshow}>
	        		<div id="allmap1" > 
	        			<div id="map" ></div>
	        			
				    </div>
	        		
	        		<div id="control" >
							
						<input type="button" value="获取绘制的覆盖物个数" onclick="alert(overlays.length)"/>
	                    <input type="button" value="清除所有覆盖物" onclick="clearAll()"/>
	                    <input type="button" value="获取最后一个覆盖物信息" id="getLastOverLay"/>
	                    <input type="button"  value="获取图层信息" onclick="getLayer(1)"/><br/>
					</div>
	        		
	        	</div>
	        	
	            <div class="panelWrap" :class={isshow:stylepanelwrapshow}>
	            	<div class="panelWrapson" :class={isshow:stylepanelwrapshow}>
	            		<layer-item :order=layerOrder ></layer-item>
	            		
	            		
	            	</div>
				  
	        	
               </div>  
               <form   id="popBox" class="popbox grid-name">
				    <div class="close">
				        <a href="javascript:void(0)" onclick="closeBox()">关闭</a>
				    </div>
				   
				    <div class="content" style= "margin:0 auto;">
				    	<ul>
							<li><span>网格名称:</span><input id="gridname" type="text" name="firstname" value="Mickey"></li>		
							<li><span>网格经理:</span><input id="gridmana" type="text" name="lastname" value="Mouse"></li>
							<li><input id="submit" type="submit" value="确定" style="width:50px; "><input id="reset" type="reset" style = "width:50px;position:relative;left:100px"  value="重填" ></li>
						</ul>
					</div>
				</form>
             
           </div>
	     
          </div> 
        
        
    </div>
    <script src="assets/js/plugins/layui/layui.all.js"></script>
    <script th:inline="javascript" >

 
    //菜单组件
        var menuItem = {
        props: ['labeltext','styleobject','order'],
		template: `
          <li class="sidebar-nav-link" @click=menuclick>
                    <a href="#">
                        <i v-bind:class="styleobject"></i> {{ labeltext }}
                    </a>
         </li>
          `  ,
          methods:{
                menuclick(){
                    
                    this.$emit('menuitemclick',this.order);
                }
          }   
        };
        var singleLayer = {
  			props:['layerChange'],
  			data:function(){
            	return {
            		layersget:[{layerId:null,layerName:null,layerData:null,userId:null}],
            		 styleObjectLabel: {
					    color: '#868E8E',
					    fontSize: '13px',
					    height:'30px',
					    border:'2px solid #fff',
					    background:'#F8F8F8',
					    width:'50%'
						
					  }
            	}
            },
  			template:`
  			<div>
  	
  				<div v-for="layer in this.layersget" >
  					<li><div :style="styleObjectLabel">{{layer.layerName}} <span class="am-icon-eye" ></span></div></li>
  					</div>
  					<div style="visibility: hidden">{{getmsg}}</div>	<!--计算属性执行，函数getmsg返回值为layerchange,该值变化就会执行该函数	-->	
  			</div>
  			`,
  			computed:{
  				
				getmsg:function(){   //获取图层的请求
				var that = this;
				var postconfig={
	                   method: 'get',
	                   url:'layerlist' 
	               };
	          
		 		 axios(postconfig)
	               .then(
	               	function (response) {
	               		 console.log(response);
					      that.layersget = response.data;
					      
					      }
	                                
	               )
	               .catch(function (error) {
	                   console.log(error);
	               
	               });  //axios
	               return that.layerChange;
				}
				
					
			}
			
			
  		}   ;
        //图层内容
        var layerItem = {
            props: ['order'],
              components: {
                'single-layer':singleLayer             
            },
            data:function(){
            	return{
            		watchLayerChange:false   //图层变化监控，如图层变动，该值反向
            	}
            },
            template: `
            <div id="test">
                    <div v-show="order === 1">
                        <button id="drawDiscrictButton" type="button" class="am-btn am-btn-secondary am-radius am-btn-block" @click=addLayer>新建图层</button>
                        <button type="button" class="am-btn am-btn-success am-radius am-btn-block">导入数据</button>
                        <single-layer :layerChange="watchLayerChange"></single-layer>
                    </div>
                    <div v-show="order === 2">
                        {{order}}
                    </div>
                    <div v-show="order === 3">
                        {{order}}
                    </div>
                    
                    <div v-show ="order === 4">
                    {{order}}
                    </div>
                
            </div>
          ` ,
          methods:{
            addLayer(){
                    var that = this;
                    layui.use(['layer', 'form'], function(){
                    var layer = layui.layer
                    ,form = layui.form;
					  layer.prompt({title: '图层名称', formType: 2}, function(text, index){
					    layer.close(index);
					  
					    var postconfig={
                                method: 'post',
                                url:'addlayer',
                                data:{
                                    layerName:text,
                   					
                                   
                                },
                                transformRequest: [function (data) { //登录时处理数据格式,处理后后台接收的参数为data按顺序传递
                                  let ret = ''
                                  for (let it in data) {
                                   ret += encodeURIComponent(it) + '=' + encodeURIComponent(data[it]) + '&'
                                  }
                                  return ret;
                              }]
                            };
                       
					     axios(postconfig)
                            .then(
                            
                                function (response) {
                               that.watchLayerChange =!that.watchLayerChange;
                                console.log(response);
                                 that.startDraw();
                                
                            })
                            .catch(function (error) {
                                console.log(error);
                            
                            });  //axios
					    
					  });//promt
						
				});
                 
                   
            },
            startDraw(){
                alert("startDraw");
                
            }


          }
        } ;
  
  	 
  		  
         new Vue({
            el: '#allpagecontent',
            components: {
                'menu-item':menuItem,
                'layer-item':layerItem
                
            },
            data:{
      		menuitems: [
		      {labeltext:"图层管理",styleobject:"am-icon-home sidebar-nav-link-logo",order:1},
		      {labeltext:"统计分析",styleobject:"am-icon-table sidebar-nav-link-logo",order:2},
		      {labeltext:"导入数据",styleobject:"am-icon-calendar sidebar-nav-link-logo" ,order:3},
		      {labeltext:" 表单",styleobject:"am-icon-wpforms sidebar-nav-link-logo",order:4 }
              ],
             styleleftactive:false,    //左边栏是否活动
             stylemainactive:false,  //
             stylepanelwrapshow:false,
             stylemapshow:false,
             layerOrder: 1   //当前操作图层框的菜单栏，为1表示当前操作框为1图层
             },
             methods:{
                autoLeft(){
                   
                    this.styleleftactive=!this.styleleftactive;
                    this.stylemainactive=!this.stylemainactive;
                    
                },
                getMenu(order){
                    if(this.layerOrder == order){
                    
                        this.stylepanelwrapshow=!this.stylepanelwrapshow;
                        this.stylemapshow=!this.stylemapshow;
                    }else{
                        this.layerOrder = order;
                    }
                }
             }
          });
          
        var map = new BMap.Map('map',{enableMapClick: false});
	    var poi = new BMap.Point(116.307852,40.057031);
	    map.centerAndZoom(poi, 16);
	    map.enableScrollWheelZoom();

    </script>
    </body>
</html>
