
<!--  备份5.17 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>我的导航栏</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
   
    <link rel="stylesheet" href="assets/css/amazeui.min.css" />
  
    <link rel="stylesheet" href="assets/css/app.css">
    <script src="assets/js/jquery.min.js"></script> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=EPgo3ahLed1MOQlZDPg1fdl0DN7Pg07w"></script>
    <!--加载鼠标绘制工具-->
	<script type="text/javascript" src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
	<link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
</head>

<body data-type="index">

  <script src="assets/js/theme_moban.js"></script>
    <div class="am-g tpl-g" id="allpagecontent">
          <!--头部  -->
        <header>
               <!--logo -->
            <div class="am-fl tpl-header-logo">
                <a href="javascript:;"><img src="assets/img/logo.png" alt=""></a>
            </div>
            <!--右侧内容 -->
            <div class="tpl-header-fluid">
                <!-- 侧边切换 -->
                <div class="am-fl tpl-header-switch-button am-icon-list">
                    <span>

                </span>
                </div>
               
              </div>

        </header>
   
        
        <!-- 侧边导航栏  -->
        <div class="left-sidebar">     
        <!-- 菜单  -->
            <ul class="sidebar-nav">
               
                <li class="sidebar-nav-link">
                    <a href="#" class="active">
                        <i class="am-icon-home sidebar-nav-link-logo"></i> 图层管理
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="#">
                        <i class="am-icon-table sidebar-nav-link-logo"></i> 统计分析
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="#">
                        <i class="am-icon-calendar sidebar-nav-link-logo"></i> 导入数据
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="#">                       
                     <i class="am-icon-wpforms sidebar-nav-link-logo"></i> 表单  </a>
                </li>
            </ul>
        </div>
        <div class="right-sidebar">
        </div>
        <!-- 内容区域  -->
        
	
	     <div class="tpl-content-wrapper" id = "mapcontent">   
	        
	        
	        <div class="tpl-content-wrapper-main" id="mapcavans" >
	        	
	        	<div id="map1_container" >
	        		<div id="allmap1" > 
	        			<div id="map" ></div>
	        			
				    </div>
	        		
	        		
	        		<div id="control" >
				
						<input type="button" value="获取绘制的覆盖物个数" onclick="alert(overlays.length)"/>
	                    <input type="button" value="清除所有覆盖物" onclick="clearAll()"/>
	                    <input type="button" value="获取最后一个覆盖物信息" id="getLastOverLay"/>
	                    <input type="button"  value="获取多边形的顶点" onclick="getPoint()"/><br/>
					</div>
	        	</div>
	        	
	            <div id="panelWrap" style="width:0px;position:absolute;top:0px;left:0px;height:100%;overflow:auto;-webkit-transition: all 0.5s ease-in-out;transition: all 0.5s ease-in-out;">
				        <div style="width:20px;height:200px;margin:-100px 0 0 -10px;color:#999;position:absolute;opacity:0.5;top:50%;left:50%;" id="showOverlayInfo">此处用于展示覆盖物信息</div>
				        <div id="panel" style="position:absolute;"></div> 
	        	
               </div>  
               <div  id="popBox" class="popbox grid-name">
				    <div class="close">
				        <a href="javascript:void(0)" onclick="closeBox()">关闭</a>
				    </div>
				   
				    <div class="content" style= "margin:0 auto;">
				    	<ul>
							<li><span>网格名称:</span><input id="gridname" type="text" name="firstname" value="Mickey"></li>		
							<li><span>网格经理:</span><input id="gridmana" type="text" name="lastname" value="Mouse"></li>
							<li><input id="submit" type="submit" value="确定" style="width:50px; "><input id="reset" type="reset" style = "width:50px;position:relative;left:100px"  value="重填" ></li>
						</ul>
					</div>
				</div>
             
           </div>
          </div> 
        
        
    </div>
    <script src="assets/js/amazeui.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
	// 百度地图API功能
	    var map = new BMap.Map('map',{enableMapClick: false});
	    var poi = new BMap.Point(116.307852,40.057031);
	    map.centerAndZoom(poi, 16);
	    map.enableScrollWheelZoom();
	    
	     //  添加菜单
	 	addMenu();
	    $("#getLastOverLay").on("click" , function(){
	        if(overlays.length){
	            alert(overlays[overlays.length - 1]);
	        }else{
	            alert("没有覆盖物");
	        }
	    });
	    
	      var overlays = [];
	      
    //回调获得覆盖物信息
	    var overlaycomplete = function(e){
	     	//鼠标进入监听
	     	var grid={};
	     	e.overlay.addEventListener("mouseover", 
	     	function(){e.overlay.setFillColor("#33FF33");
	     	e.overlay.enableEditing();
	     	//alert(e.overlay.getBounds().getSouthWest())
	     	}
	     	);
	     	//鼠标退出监听
	     	e.overlay.addEventListener("mouseout", 
	     	function(){e.overlay.setFillColor("");
	     	e.overlay.disableEditing()}
	     	);
	     	 grid.overlay = e.overlay;
	     	 grid.gridName = "";
	     	 grid.gridMana = "";
	     	 overlays.push(grid);
	     	
	        var result = "";
	        result = "<p>";
	        result += e.drawingMode + ":";
	        var isPoly = false;
	        if (e.drawingMode == BMAP_DRAWING_MARKER) {
	            result += ' 坐标：' + e.overlay.getPosition().lng + ',' + e.overlay.getPosition().lat;
	            if ($('isInfowindow').checked) {
	                searchInfoWindow.open(e.overlay);
	            }
	        }
	        if (e.drawingMode == BMAP_DRAWING_CIRCLE) {
	            result += ' 半径：' + e.overlay.getRadius();
	            result += ' 中心点：' + e.overlay.getCenter().lng + "," + e.overlay.getCenter().lat;
	        }
	        if (e.drawingMode == BMAP_DRAWING_POLYLINE || e.drawingMode == BMAP_DRAWING_POLYGON || e.drawingMode == BMAP_DRAWING_RECTANGLE) {
	            result += ' 所画的点个数：' + e.overlay.getPath().length  +" <br/>";
	            for(var j = 0; j < e.overlay.getPath().length; j++){
	                var onepoint =e.overlay.getPath()[j];
	                result += onepoint.lng+","+onepoint.lat+");<br/>";
	            }
	            if(
	            e.drawingMode == BMAP_DRAWING_POLYGON){
	            isPoly = true;
	            }
	            //e.overlay.addEventListener("mouseover", function(){allert("进入此区域");});
	            
	        }
	        result += "</p>";
	       // $("showOverlayInfo").style.display = "none";
	       // $("#panel").innerHTML += result; 
	       if(isPoly){
	        popBox(grid);
	        
	        
	       // alert(grid.gridMana);
	        }
	        //setGridAttr(grid);
	    };
	    
	    var styleOptions = {
	        strokeColor:"red",    //边线颜色。
	        fillColor:"",      //填充颜色。当参数为空时，圆形将没有填充效果。
	        strokeWeight: 3,       //边线的宽度，以像素为单位。
	        strokeOpacity: 0.8,	   //边线透明度，取值范围0 - 1。
	        fillOpacity: 0.6,      //填充的透明度，取值范围0 - 1。
	        strokeStyle: 'solid' //边线的样式，solid或dashed。
   	    }
   		 
   		 //实例化鼠标绘制工具
	    var drawingManager = new BMapLib.DrawingManager(map, {
	        isOpen: false, //是否开启绘制模式
	        drawingType: BMAP_DRAWING_POLYGON,
	         //绘制工具栏的选择
	        enableDrawingTool: true, //是否显示工具栏
	        drawingToolOptions: {
	            anchor: BMAP_ANCHOR_TOP_RIGHT, //位置
	            offset: new BMap.Size(5, 10), //偏离值
	            scale: 0.8 ,//工具栏缩放比例
	            drawingTypes : [
	            //BMAP_DRAWING_MARKER,
	            //BMAP_DRAWING_CIRCLE,
	           // BMAP_DRAWING_POLYLINE,
	            BMAP_DRAWING_POLYGON,
	            //BMAP_DRAWING_RECTANGLE 
         		],
         		drawingModes:[BMAP_DRAWING_POLYGON]
	        },
	        //circleOptions: styleOptions, //圆的样式
	       // polylineOptions: styleOptions, //线的样式
	        polygonOptions: styleOptions, //多边形的样式
	        //rectangleOptions: styleOptions //矩形的样式
	    }); 
	    
	     //添加鼠标绘制工具监听事件，用于获取绘制结果
    	drawingManager.addEventListener('overlaycomplete', overlaycomplete);
    
		 function clearAll() {
		        for(var i = 0; i < overlays.length; i++){
		            map.removeOverlay(overlays[i].overlay);
		        }
		        overlays.length = 0;
		        $("#panel")[0].innerHTML='';
		    }
		 
		    var isPanelShow = false;
		    //显示结果面板动作
		    $("#showPanelBtn").on("click" ,showPanel);
		    function showPanel(){
		        if (isPanelShow == false) {
		            isPanelShow = true;
		            $("#showPanelBtn")[0].style.left = "230px";
		            
		            $("#panelWrap")[0].style.width = "230px";
		            $("#map1_container")[0].style.marginLeft = "230px";
		            $("#showPanelBtn")[0].innerHTML = "隐藏绘制结果信息<br/>>";
		        } else {
		            isPanelShow = false;
		            $("#showPanelBtn")[0].style.left = "0px";
		            $("#panelWrap")[0].style.width = "0px";
		            $("#map1_container")[0].style.marginLeft = "0px";
		            $("#showPanelBtn")[0].innerHTML = "显示绘制结果信息<br/><";
		        }
		    }
    
	    //可编辑(参数enable)
	   function Editing(state){
	        for(var i = 0; i < overlays.length; i++){
	            state=='enable'?overlays[i].overlays.enableEditing():overlays[i].overlays.disableEditing();
	        }
	    }
	   //获取点的信息多边形或折线 
	   function getPoint(){
	        
	        $("#panel")[0].innerHTML='多边形信息：'; 
	        var multiPoly = new PolygonConection(); 
	        for(var i = 0; i < overlays.length; i++){
	        	var coordinatesOfPoly = [];
	        	var properties ={};
	        	properties.gridName = overlays[i].gridName;
	        	properties.gridMana = overlays[i].gridMana;
	            var overlay=overlays[i].overlay.getPath();
	         	
	            $("#panel")[0].innerHTML=$("#panel")[0].innerHTML+overlays[i].gridName+overlay.length+'边形:<br/>';
	            for(var j = 0; j < overlay.length; j++){
	                var grid =overlay[j];
	                $("#panel")[0].innerHTML=$("#panel")[0].innerHTML+(j+1)+"个点:("+grid.lng+","+grid.lat+");<br/>";
	                var onepoint = [];
	                onepoint.push(grid.lng);
	                onepoint.push(grid.lat);
	                coordinatesOfPoly.push(onepoint);
	            }
	            var psgeo = new polygonString();  //多边形的GEOjson
	            psgeo.setCoordinates(coordinatesOfPoly); //多边形添加坐标
	            psgeo.setProperties(properties);
	            multiPoly.addPolygon(psgeo);     //几何集合的GEOJSON添加该多边形
	          	
	        }
	        alert( JSON.stringify(multiPoly));
	    }
	    
	    //添加右键菜单
	    function addMenu(){
	    	
	    	var menu = new BMap.ContextMenu();
			var txtMenuItem = [
			{
				text:'保存',
				callback:function(){getPoint();}
			},
			{
				text:'更改名称',
				callback:function(){}
			}
		];
		for(var i=0; i < txtMenuItem.length; i++){
			menu.addItem(new BMap.MenuItem(txtMenuItem[i].text,txtMenuItem[i].callback,100));
		}
		map.addContextMenu(menu);
	    }
	    
	  
	

    </script>

    
</body>

</html>